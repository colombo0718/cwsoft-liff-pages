<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>åŠ å…¥æœƒå“¡ï½œé€²éšè¡ŒéŠ·æ–¹æ¡ˆ Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <style>
    :root {
      --bg: #0f172a;
      --card: #020617;
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.15);
      --text-main: #e5e7eb;
      --text-sub: #9ca3af;
      --border: #1f2937;
      --danger: #ef4444;
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #1f2937 0, #020617 55%, #000 100%);
      color: var(--text-main);
      padding: 16px;
    }

    .card {
      width: 100%;
      max-width: 420px;
      background: var(--card);
      border-radius: 18px;
      border: 1px solid var(--border);
      padding: 20px 18px 18px;
      box-shadow: 0 22px 45px rgba(0, 0, 0, 0.48);
    }

    .card-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 12px rgba(34, 197, 94, 0.8);
    }

    .title-group {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    h1 {
      font-size: 18px;
      margin: 0;
      font-weight: 600;
      letter-spacing: 0.04em;
    }

    .subtitle {
      font-size: 12px;
      color: var(--text-sub);
    }

    .badge {
      margin-left: auto;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: var(--accent-soft);
      color: #bbf7d0;
      border: 1px solid rgba(34, 197, 94, 0.3);
    }

    .hint {
      font-size: 12px;
      color: var(--text-sub);
      margin-bottom: 10px;
      line-height: 1.5;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 8px;
    }

    label {
      font-size: 13px;
      color: var(--text-main);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .label-main {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .label-main span.required {
      color: var(--danger);
      font-size: 13px;
    }

    input, textarea {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #020617;
      color: var(--text-main);
      font-size: 14px;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    input::placeholder,
    textarea::placeholder {
      color: #6b7280;
      font-size: 13px;
    }

    input:focus,
    textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.35);
      background: #020617;
    }

    textarea {
      min-height: 64px;
      resize: vertical;
    }

    .btn {
      margin-top: 6px;
      padding: 10px 12px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #22c55e, #4ade80);
      color: #022c22;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      box-shadow: 0 16px 30px rgba(34, 197, 94, 0.45);
      transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.12s ease;
    }

    .btn:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: 0 8px 18px rgba(34, 197, 94, 0.5);
      filter: brightness(0.96);
    }

    .btn span.icon {
      font-size: 16px;
    }

    .status {
      margin-top: 8px;
      font-size: 12px;
      color: var(--text-sub);
      min-height: 16px;
      white-space: pre-line;
    }

    .status.error {
      color: #fecaca;
    }

    .status.success {
      color: #bbf7d0;
    }

    .preview {
      margin-top: 10px;
      padding: 8px 10px;
      border-radius: 10px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px dashed #334155;
      font-size: 12px;
      color: #e5e7eb;
      max-height: 110px;
      overflow-y: auto;
      line-height: 1.5;
    }

    .preview-title {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 4px;
    }

    .env-warning {
      margin-top: 6px;
      font-size: 11px;
      color: #facc15;
      display: none;
    }

    @media (max-width: 360px) {
      .card {
        padding: 18px 14px 16px;
      }
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="card-header">
      <div class="dot"></div>
      <div class="title-group">
        <h1>åŠ å…¥æœƒå“¡</h1>
        <div class="subtitle">é€²éšè¡ŒéŠ·æ–¹æ¡ˆ Â· Line å®˜æ–¹å¸³è™Ÿç¶å®š</div>
      </div>
      <div class="badge">Demo</div>
    </div>

    <div class="hint">
      è«‹å¡«å¯«æ‚¨çš„åŸºæœ¬è³‡æ–™ï¼Œé€å‡ºå¾Œæœƒä»¥ä¸€å‰‡è¨Šæ¯å‚³åˆ° Line å°è©±è¦–çª—ï¼Œ<br>
      æ–¹ä¾¿é–€å¸‚äººå“¡èˆ‡ç³»çµ±å®Œæˆæœƒå“¡ç¶å®šã€‚
    </div>

    <form id="member-form">
      <label>
        <div class="label-main">
          æ‰‹æ©Ÿè™Ÿç¢¼ <span class="required">*</span>
        </div>
        <input id="phone" type="tel" inputmode="numeric" placeholder="ä¾‹å¦‚ï¼š0912-345-678" required />
      </label>

      <label>
        <div class="label-main">
          å§“å <span class="required">*</span>
        </div>
        <input id="name" type="text" placeholder="ä¾‹å¦‚ï¼šç‹å°æ˜" required />
      </label>

      <label>
        <div class="label-main">
          é€šè¨Šåœ°å€
        </div>
        <input id="address" type="text" placeholder="ä¾‹å¦‚ï¼šå°å—å¸‚æ±å€æˆåŠŸè·¯ 123 è™Ÿ" />
      </label>

      <label>
        <div class="label-main">
          å‚™è¨»
        </div>
        <textarea id="note" placeholder="ä¾‹å¦‚ï¼šå¸¸ç”¨åˆ†åº—ã€ç‰¹æ®Šéœ€æ±‚ã€ç”Ÿæ—¥ç­‰â€¦"></textarea>
      </label>

      <button type="submit" class="btn">
        <span class="icon">âœ…</span>
        <span>é€å‡ºï¼Œå¯«å…¥ Line è¨Šæ¯</span>
      </button>
    </form>

    <div class="status" id="status"></div>

    <div class="preview" id="preview">
      <div class="preview-title">ğŸ“¨ é è¦½ï¼šé€åˆ° Line å°è©±çš„å…§å®¹</div>
      <div id="preview-body">ï¼ˆè«‹å…ˆè¼¸å…¥ä¸Šæ–¹è³‡æ–™â€¦ï¼‰</div>
    </div>

    <div class="env-warning" id="env-warning">
      âš ï¸ åµæ¸¬ä¸åˆ° LIFF ç’°å¢ƒï¼Œç›®å‰åœ¨ä¸€èˆ¬ç€è¦½å™¨æ¨¡å¼ã€‚å¯¦éš›è¦æ¸¬è©¦é€è¨Šæ¯ï¼Œéœ€è¦å¾ Line OA çš„ LIFF å…¥å£é–‹å•Ÿã€‚
    </div>
  </div>

  <script>
    const LIFF_ID = "2008039127-p7We0QWm"; // è¨˜å¾—æ›æˆä½ è‡ªå·±çš„ LIFF ID

    const phoneInput = document.getElementById("phone");
    const nameInput = document.getElementById("name");
    const addressInput = document.getElementById("address");
    const noteInput = document.getElementById("note");
    const statusEl = document.getElementById("status");
    const previewBodyEl = document.getElementById("preview-body");
    const envWarningEl = document.getElementById("env-warning");
    const form = document.getElementById("member-form");

    let liffReady = false;

    function buildMessageText() {
      const phone = phoneInput.value.trim();
      const name = nameInput.value.trim();
      const address = addressInput.value.trim();
      const note = noteInput.value.trim();

      let lines = [];
      lines.push("ã€åŠ å…¥æœƒå“¡ç”³è«‹ã€‘");
      if (name)   lines.push("å§“åï¼š" + name);
      if (phone)  lines.push("æ‰‹æ©Ÿï¼š" + phone);
      if (address) lines.push("åœ°å€ï¼š" + address);
      if (note)   lines.push("å‚™è¨»ï¼š" + note);

      return lines.join("\n");
    }

    function updatePreview() {
      const text = buildMessageText();
      previewBodyEl.textContent = text || "ï¼ˆè«‹å…ˆè¼¸å…¥ä¸Šæ–¹è³‡æ–™â€¦ï¼‰";
    }

    phoneInput.addEventListener("input", updatePreview);
    nameInput.addEventListener("input", updatePreview);
    addressInput.addEventListener("input", updatePreview);
    noteInput.addEventListener("input", updatePreview);

    async function initLiff() {
      if (!window.liff) {
        envWarningEl.style.display = "block";
        return;
      }

      try {
        await liff.init({ liffId: LIFF_ID });
        liffReady = true;

        if (!liff.isInClient()) {
          envWarningEl.style.display = "block";
        }
      } catch (err) {
        console.error("LIFF åˆå§‹åŒ–å¤±æ•—ï¼š", err);
        statusEl.textContent = "LIFF åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹æª¢æŸ¥ LIFF ID æˆ–è¨­å®šã€‚";
        statusEl.className = "status error";
      }
    }

    form.addEventListener("submit", async (event) => {
      event.preventDefault();
      statusEl.textContent = "";
      statusEl.className = "status";

      const phone = phoneInput.value.trim();
      const name = nameInput.value.trim();

      if (!phone || !name) {
        statusEl.textContent = "è«‹è‡³å°‘å¡«å¯«ã€Œå§“åã€èˆ‡ã€Œæ‰‹æ©Ÿè™Ÿç¢¼ã€ã€‚";
        statusEl.className = "status error";
        return;
      }

      const text = buildMessageText();
      updatePreview();

      // é LIFF ç’°å¢ƒï¼Œæ”¹æˆåªé¡¯ç¤ºåœ¨ç•«é¢ä¸Šï¼Œæ–¹ä¾¿ä½ åœ¨ç€è¦½å™¨å…ˆçœ‹æ•ˆæœ
      if (!liffReady || !liff.isInClient()) {
        console.log("Demo æ¨¡å¼ï¼šæœªåœ¨ LIFF å…§ï¼Œåƒ…é¡¯ç¤ºè¨Šæ¯å…§å®¹ã€‚");
        statusEl.textContent = "Demo æ¨¡å¼ï¼šç›®å‰ä¸åœ¨ LIFF å…§ï¼Œåªé¡¯ç¤ºé è¦½ï¼Œä¸æœƒçœŸçš„é€è¨Šæ¯ã€‚";
        statusEl.className = "status success";
        return;
      }

      try {
        await liff.sendMessages([
          {
            type: "text",
            text
          }
        ]);
        statusEl.textContent = "å·²å°‡åŠ å…¥æœƒå“¡è³‡è¨Šé€åˆ° Line å°è©±è¦–çª—ï¼Œè«‹ç­‰å¾…é–€å¸‚äººå“¡è™•ç†ã€‚";
        statusEl.className = "status success";

        // å¯é¸ï¼šé€å‡ºå¾Œé—œé–‰ LIFF
        // setTimeout(() => liff.closeWindow(), 800);
      } catch (err) {
        console.error("é€è¨Šæ¯å¤±æ•—ï¼š", err);
        statusEl.textContent = "é€è¨Šæ¯å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦æˆ–æ´½é–€å¸‚äººå“¡ã€‚";
        statusEl.className = "status error";
      }
    });

    // åˆå§‹åŒ–
    updatePreview();
    initLiff();
  </script>
</body>
</html>
